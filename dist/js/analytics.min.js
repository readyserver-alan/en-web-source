window.dataLayer=window.dataLayer||[];const PAGE_KEY_MAP={"/":"home","/download-mobile-app":"download_mobile_app","/vps-hosting":"vps_hosting","/windows-vps":"windows_vps","/contact":"contact","/blog":"blog","/brand-guidelines":"brand_guidelines","/privacy-policy":"privacy_policy","/terms-of-service":"terms_of_service","/sla":"sla"},PAGE_TYPE_MAP={"/":"landing","/download-mobile-app":"landing","/vps-hosting":"product","/windows-vps":"product","/contact":"support","/blog":"blog","/brand-guidelines":"other","/privacy-policy":"legal","/terms-of-service":"legal","/sla":"legal"},STORE_HOSTS=["apps.apple.com","itunes.apple.com","play.google.com"];function getPageKey(){const t=window.location.pathname;return PAGE_KEY_MAP[t]?PAGE_KEY_MAP[t]:t.startsWith("/blog/")&&t.length>6?"blog_post":"other"}function getPageType(){const t=window.location.pathname;return PAGE_TYPE_MAP[t]?PAGE_TYPE_MAP[t]:t.startsWith("/blog/")?"blog":"other"}function isStoreLink(t){try{const e=new URL(t);return STORE_HOSTS.includes(e.hostname)}catch{return!1}}function deriveDestination(t){try{const e=new URL(t);return e.hostname.includes("apple.com")?"app_store":e.hostname.includes("play.google.com")?"play_store":"unknown"}catch{return"unknown"}}function isInternalLink(t){try{return new URL(t,window.location.origin).origin===window.location.origin}catch{return t.startsWith("/")||t.startsWith("#")}}function generateEventId(){return`${Date.now()}_${Math.random().toString(36).substring(2,8)}`}function sanitizeUrl(t){try{const e=new URL(t,window.location.origin),n=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],i=new URLSearchParams;for(const t of n)e.searchParams.has(t)&&i.set(t,e.searchParams.get(t));return e.pathname+(i.toString()?"?"+i.toString():"")}catch{return t}}function getVariant(){return"control"}function getDeviceType(){const t=window.innerWidth;return t<768?"mobile":t<1024?"tablet":"desktop"}function getUTMParams(){const t=new URLSearchParams(window.location.search);return{utm_source:t.get("utm_source"),utm_medium:t.get("utm_medium"),utm_campaign:t.get("utm_campaign"),utm_term:t.get("utm_term"),utm_content:t.get("utm_content"),gclid:t.get("gclid"),fbclid:t.get("fbclid")}}function storeAttribution(){const t=getUTMParams();Object.values(t).some(t=>null!==t)&&sessionStorage.setItem("traffic_attribution",JSON.stringify({...t,landing_page:window.location.pathname,referrer:document.referrer,timestamp:(new Date).toISOString()}))}function getStoredAttribution(){try{const t=sessionStorage.getItem("traffic_attribution");return t?JSON.parse(t):{}}catch{return{}}}function trackEvent(t,e={}){const n={event:t,...{page_path:window.location.pathname,page_key:getPageKey(),page_type:getPageType(),device_type:getDeviceType(),event_timestamp:(new Date).toISOString()},...e};window.dataLayer.push(n),"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||console.log("[Analytics]",t,n)}function setupSectionTracking(){const t=document.querySelectorAll("[data-track-section]");if(0===t.length)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const n=t.target;trackEvent("view_section",{section:n.getAttribute("data-track-section"),section_label:n.getAttribute("data-section-label")||null}),e.unobserve(n)}})},{threshold:.35,rootMargin:"0px"});t.forEach(t=>e.observe(t))}trackEvent("page_view",{page_key:getPageKey(),page_type:getPageType(),page_referrer:document.referrer||null}),storeAttribution(),document.addEventListener("click",t=>{const e=t.target.closest("[data-gtm-id]");if(!e)return;const n=e.getAttribute("data-gtm-id");if(!n)return;const i=e.getAttribute("data-gtm-placement")||"unknown",a=e.getAttribute("data-gtm-section")||"unknown",o=e.getAttribute("data-gtm-destination"),r=e.getAttribute("data-gtm-faq-label"),c="A"===e.tagName?e:e.closest("a"),s=c?.href,l=generateEventId();if(s&&isStoreLink(s))trackEvent("store_outbound_click",{event_id:l,cta_id:n,placement:i,section:a,destination:o||deriveDestination(s),url:s,link_type:"store",variant:getVariant()});else if(s&&isInternalLink(s))trackEvent("cta_click",{event_id:l,cta_id:n,placement:i,section:a,url:sanitizeUrl(s),link_type:"internal",variant:getVariant()});else if(!s||isInternalLink(s))n.includes(".faq.")?trackEvent("faq_open",{event_id:l,faq_id:n,faq_label:r||null,section:a}):n.includes(".form.submit")||n.includes(".form.")?trackEvent("form_submit",{event_id:l,form_id:n,section:a}):trackEvent("ui_interaction",{event_id:l,element_id:n,element_type:e.tagName.toLowerCase()});else try{trackEvent("outbound_link_click",{event_id:l,url:s,link_domain:new URL(s).hostname,link_type:"external"})}catch{}}),document.addEventListener("click",t=>{const e=t.target.closest("a[href]");if(!e)return;if(e.closest("[data-gtm-id]"))return;const n=e.href;if(!isInternalLink(n)&&!isStoreLink(n))try{trackEvent("outbound_link_click",{event_id:generateEventId(),url:n,link_domain:new URL(n).hostname,link_type:"external"})}catch{}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",setupSectionTracking):setupSectionTracking();const scrollMilestones=[25,50,75,100],scrollTracked=new Set;function trackScrollDepth(){const t=window.scrollY,e=document.documentElement.scrollHeight-window.innerHeight;if(e<=0)return;const n=Math.round(t/e*100);scrollMilestones.forEach(t=>{n>=t&&!scrollTracked.has(t)&&(scrollTracked.add(t),trackEvent("scroll_depth",{scroll_percentage:t,page_key:getPageKey()}))})}let scrollTimeout;window.addEventListener("scroll",()=>{scrollTimeout||(scrollTimeout=setTimeout(()=>{trackScrollDepth(),scrollTimeout=null},100))},{passive:!0});const timeIntervals=[30,60,120,300];let timeOnPage=0;const timeTracked=new Set;function trackStoreClick(t,e,n,i,a){trackEvent("store_outbound_click",{event_id:generateEventId(),cta_id:t,placement:e,section:n,destination:i,url:a,link_type:"store",variant:getVariant()})}function trackCTAClick(t,e,n,i){trackEvent("cta_click",{event_id:generateEventId(),cta_id:t,placement:e,section:n,url:sanitizeUrl(i),link_type:"internal",variant:getVariant()})}function trackFormSubmit(t,e=!0,n=null){e?trackEvent("form_submit",{event_id:generateEventId(),form_id:t}):trackEvent("form_submit_failed",{event_id:generateEventId(),form_id:t,error_message:n})}setInterval(()=>{timeOnPage+=10,timeIntervals.forEach(t=>{timeOnPage>=t&&!timeTracked.has(t)&&(timeTracked.add(t),trackEvent("time_on_page",{time_seconds:t,page_key:getPageKey()}))})},1e4),window.trackEvent=trackEvent,window.trackStoreClick=trackStoreClick,window.trackCTAClick=trackCTAClick,window.trackFormSubmit=trackFormSubmit,window.generateEventId=generateEventId;
{# 
Header Component

Fixed navigation header with:
- Logo with link to home
- Desktop navigation with hover dropdown menus
- Active page highlighting (via Alpine.js)
- Mobile hamburger menu
- Theme toggle
- CTA button
- Analytics tracking for all navigation interactions

Uses Alpine.js for interactivity (replaces Framer Motion)
#}

{# Navigation Configuration #}
{# Note: Dedicated Servers links to external dedicated-server.readyserver.sg subdomain #}
{% set nav_items = [
    {
        'label': 'Products & Services',
        'href': '/vps-hosting',
        'children': [
            {'label': 'VPS Hosting', 'href': '/vps-hosting'},
            {'label': 'Windows VPS', 'href': '/windows-vps'},
            {'label': 'Dedicated Servers', 'href': 'https://dedicated-server.readyserver.sg/dedicatedserver.html', 'external': true}
        ]
    },
    {'label': 'Blog', 'href': '/blog'},
    {'label': 'Contact Us', 'href': '/contact'}
] %}

<header 
    class="fixed top-0 left-0 right-0 z-[9999] bg-background/80 backdrop-blur-xl animate-fade-up"
    x-data="{ 
        mobileOpen: false,
        mobileDropdownOpen: false,
        currentPath: window.location.pathname
    }"
    @keydown.escape.window="mobileOpen = false; $store.mobileMenu?.close()"
>
    <div class="container mx-auto px-6 py-5 flex items-center justify-between relative">
        
        {# Logo - 10% larger, aria-label for accessibility when text is hidden on mobile #}
        <a href="/" class="flex items-center gap-3 group" data-gtm-id="nav.logo.click" aria-label="Ready Server - Home">
            <div class="w-11 h-11 bg-primary rounded-xl flex items-center justify-center overflow-hidden transition-transform duration-300 group-hover:scale-105">
                {# Logo with srcset for proper sizing - source is 225x225, displayed at 44x44 (88x88 @2x) #}
                <img 
                    src="/images/logo/readyserver-logo.jpeg" 
                    srcset="/images/logo/readyserver-logo.jpeg 1x, /images/logo/readyserver-logo.jpeg 2x"
                    alt=""
                    aria-hidden="true"
                    width="44"
                    height="44"
                    fetchpriority="high"
                    decoding="async"
                    class="w-full h-full object-cover"
                >
            </div>
            <span class="font-bold text-[1.375rem] hidden sm:block text-foreground" aria-hidden="true">
                Ready Server
            </span>
        </a>

        {# Desktop Navigation - 10% larger text #}
        <nav class="hidden md:flex items-center gap-8 relative">
            {% for item in nav_items %}
                {% if item.children %}
                    {# Dropdown Menu #}
                    <div 
                        class="relative z-[100]"
                        x-data="{ open: false }"
                        @mouseenter="open = true"
                        @mouseleave="open = false"
                    >
                        {# Dropdown Trigger #}
                        <button
                            class="flex items-center gap-1.5 font-medium transition-colors py-2 px-1 text-[1.0625rem]"
                            :class="[{% for child in item.children %}'{{ child.href }}'{% if not loop.last %}, {% endif %}{% endfor %}].includes(currentPath)
                                    ? 'text-primary'
                                    : 'text-muted-foreground hover:text-foreground'"
                            data-gtm-id="nav.dropdown.products.open"
                        >
                            {{ item.label }}
                            <svg 
                                class="w-4 h-4 transition-transform duration-200" 
                                :class="open ? 'rotate-180' : ''"
                                fill="none" 
                                stroke="currentColor" 
                                viewBox="0 0 24 24"
                            >
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>

                        {# Active Indicator #}
                        <div 
                            x-show="[{% for child in item.children %}'{{ child.href }}'{% if not loop.last %}, {% endif %}{% endfor %}].includes(currentPath)"
                            class="absolute -bottom-4 left-0 right-0 h-0.5 bg-primary rounded-full"
                        ></div>

                        {# Dropdown Panel - Optimized for GPU compositing #}
                        <div 
                            x-show="open"
                            x-transition:enter="transition ease-out duration-150"
                            x-transition:enter-start="opacity-0 scale-95"
                            x-transition:enter-end="opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-100"
                            x-transition:leave-start="opacity-100 scale-100"
                            x-transition:leave-end="opacity-0 scale-95"
                            class="absolute top-full left-1/2 -translate-x-1/2 pt-4"
                            style="z-index: 99999; will-change: transform, opacity;"
                        >
                            <div class="bg-card border border-border rounded-xl shadow-2xl overflow-hidden min-w-[220px] backdrop-blur-xl">
                                {% for child in item.children %}
                                    <a
                                        href="{{ child.href }}"
                                        {% if child.external %}target="_blank" rel="noopener noreferrer"{% endif %}
                                        class="block px-4 py-3 transition-colors"
                                        :class="{% if not child.external %}currentPath === '{{ child.href }}'
                                            ? 'bg-primary/10 text-primary font-medium'
                                            : {% endif %}'text-muted-foreground hover:bg-muted hover:text-foreground'"
                                        data-gtm-id="nav.link.{{ child.label | lower | replace(' ', '-') }}.click"
                                    >
                                        <span class="flex items-center gap-2">
                                            {% if not child.external %}
                                            <span 
                                                x-show="currentPath === '{{ child.href }}'"
                                                class="w-1.5 h-1.5 rounded-full bg-primary"
                                            ></span>
                                            {% endif %}
                                            {{ child.label }}
                                            {% if child.external %}
                                            <svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                            </svg>
                                            {% endif %}
                                        </span>
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% else %}
                    {# Regular Nav Link - 10% larger text #}
                    <div class="relative">
                        <a
                            href="{{ item.href }}"
                            class="font-medium transition-colors py-2 px-1 block hover:-translate-y-0.5 transform transition-transform text-[1.0625rem]"
                            :class="currentPath === '{{ item.href }}' || currentPath.startsWith('{{ item.href }}/')
                                ? 'text-primary'
                                : 'text-muted-foreground hover:text-foreground'"
                            data-gtm-id="nav.link.{{ item.href.split('/')[-1] or 'home' }}.click"
                        >
                            {{ item.label }}
                        </a>
                        {# Active Indicator #}
                        <div 
                            x-show="currentPath === '{{ item.href }}' || currentPath.startsWith('{{ item.href }}/')"
                            class="absolute -bottom-4 left-0 right-0 h-0.5 bg-primary rounded-full"
                        ></div>
                    </div>
                {% endif %}
            {% endfor %}
        </nav>

        {# Desktop Actions #}
        <div class="hidden md:flex items-center gap-4">
            {# Theme Toggle #}
            {% include 'components/theme-toggle.html' %}
            
            {# Language Switcher Button - Secondary style with 3D effect #}
            <a 
                href="https://zh.readyserver.sg/"
                class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-[0.9375rem] font-medium text-muted-foreground hover:text-foreground border-2 border-foreground/20 dark:border-white/20 bg-background hover:bg-muted shadow-sm hover:shadow-md transition-all duration-300 hover:scale-105 hover:-translate-y-0.5"
                data-gtm-id="nav.language.zh.click"
            >
                中文
            </a>
            
            {# CTA Button - 10% larger #}
            <a 
                href="/download-mobile-app"
                class="inline-flex items-center justify-center rounded-xl px-5 py-2.5 text-[0.9375rem] font-semibold bg-primary text-primary-foreground hover:bg-primary/90 transition-all duration-300 hover:scale-105 shadow-md hover:shadow-lg"
                data-gtm-id="nav.download_app"
                data-gtm-placement="nav"
                data-gtm-section="nav"
            >
                Download App
            </a>
        </div>

        {# Mobile Menu Toggle #}
        <div class="flex md:hidden items-center gap-3">
            {# Theme Toggle #}
            {% include 'components/theme-toggle.html' %}
            
            <button
                class="text-foreground p-2"
                @click="mobileOpen = !mobileOpen"
                :aria-label="mobileOpen ? 'Close menu' : 'Open menu'"
                data-gtm-id="nav.mobile.menu.toggle"
            >
                {# Hamburger Icon #}
                <svg 
                    x-show="!mobileOpen" 
                    class="w-6 h-6" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
                {# Close Icon #}
                <svg 
                    x-show="mobileOpen" 
                    x-cloak
                    class="w-6 h-6" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </div>

    {# Mobile Menu #}
    <div 
        x-show="mobileOpen"
        x-collapse
        class="md:hidden bg-background border-b border-border"
    >
        <nav class="flex flex-col p-6 gap-4">
            {% for item in nav_items %}
                {% if item.children %}
                    {# Mobile Dropdown #}
                    <div>
                        <button
                            class="flex items-center justify-between w-full font-medium py-2"
                            :class="[{% for child in item.children %}'{{ child.href }}'{% if not loop.last %}, {% endif %}{% endfor %}].includes(currentPath)
                                ? 'text-primary'
                                : 'text-muted-foreground'"
                            @click="mobileDropdownOpen = !mobileDropdownOpen"
                        >
                            <span class="flex items-center gap-2">
                                <span 
                                    x-show="[{% for child in item.children %}'{{ child.href }}'{% if not loop.last %}, {% endif %}{% endfor %}].includes(currentPath)"
                                    class="w-1.5 h-1.5 rounded-full bg-primary"
                                ></span>
                                {{ item.label }}
                            </span>
                            <svg 
                                class="w-4 h-4 transition-transform duration-200"
                                :class="mobileDropdownOpen ? 'rotate-180' : ''"
                                fill="none" 
                                stroke="currentColor" 
                                viewBox="0 0 24 24"
                            >
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        
                        <div 
                            x-show="mobileDropdownOpen"
                            x-collapse
                            class="pl-4 flex flex-col gap-2 mt-2"
                        >
                            {% for child in item.children %}
                                <a
                                    href="{{ child.href }}"
                                    {% if child.external %}target="_blank" rel="noopener noreferrer"{% endif %}
                                    class="transition-colors py-1 flex items-center gap-2"
                                    :class="{% if not child.external %}currentPath === '{{ child.href }}'
                                        ? 'text-primary font-medium'
                                        : {% endif %}'text-muted-foreground hover:text-foreground'"
                                    @click="mobileOpen = false"
                                    data-gtm-id="nav.mobile.{{ child.label | lower | replace(' ', '-') }}.click"
                                >
                                    {% if not child.external %}
                                    <span 
                                        x-show="currentPath === '{{ child.href }}'"
                                        class="w-1.5 h-1.5 rounded-full bg-primary"
                                    ></span>
                                    {% endif %}
                                    {{ child.label }}
                                    {% if child.external %}
                                    <svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                    {% endif %}
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    {# Mobile Nav Link #}
                    <a
                        href="{{ item.href }}"
                        class="transition-colors font-medium py-2 flex items-center gap-2"
                        :class="currentPath === '{{ item.href }}' || currentPath.startsWith('{{ item.href }}/')
                            ? 'text-primary'
                            : 'text-muted-foreground hover:text-foreground'"
                        @click="mobileOpen = false"
                        data-gtm-id="nav.mobile.{{ item.href.split('/')[-1] or 'home' }}.click"
                    >
                        <span 
                            x-show="currentPath === '{{ item.href }}' || currentPath.startsWith('{{ item.href }}/')"
                            class="w-1.5 h-1.5 rounded-full bg-primary"
                        ></span>
                        {{ item.label }}
                    </a>
                {% endif %}
            {% endfor %}
            
            {# Mobile Language Switcher - with 3D effect #}
            <a 
                href="https://zh.readyserver.sg/"
                class="inline-flex items-center justify-center w-full rounded-lg px-4 py-3 text-sm font-medium text-muted-foreground hover:text-foreground border-2 border-foreground/20 dark:border-white/20 bg-background hover:bg-muted shadow-sm hover:shadow-md transition-all duration-300 hover:scale-105 hover:-translate-y-0.5 mt-4"
                @click="mobileOpen = false"
                data-gtm-id="nav.mobile.language.zh.click"
            >
                中文
            </a>
            
            {# Mobile CTA #}
            <a 
                href="/download-mobile-app"
                class="inline-flex items-center justify-center w-full rounded-lg px-4 py-3 text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 transition-colors mt-2"
                @click="mobileOpen = false"
                data-gtm-id="nav.mobile.download_app"
                data-gtm-placement="nav"
                data-gtm-section="nav.mobile"
            >
                Download App
            </a>
        </nav>
    </div>
</header>

{# Spacer for fixed header (increased for larger nav) #}
<div class="h-[80px]"></div>

<style>
    [x-cloak] { display: none !important; }
</style>

